%!TEX encoding = UTF-8 Unicode
%!TEX root = ../compendium2.tex

\chapter{Editera, kompilera och exekvera}\label{appendix:compile}

\section{Vad är en editor?}

En editor används för att redigera programkod. Det finns många olika editorer att välja på. Erfarna utvecklare lägger ofta mycket energi på att lära sig att använda favoriteditorns kortkommandon och specialfunktioner, eftersom detta påverkar stort hur snabbt kodredigeringen kan göras.

En bra editor har \textbf{syntaxfärgning} för språket du använder, så att olika delar av koden visas i olika färger. Då går det mycket lättare att läsa och hitta i koden.

Nedan listas några viktiga funktioner som man använder många gånger dagligen när man kodar:

\begin{itemize}
\item \textbf{Navigera}. Det finns flera olika sätt att flytta markören och bläddra genom koden. Alla editorer erbjuder sökmöjligheter, och de flesta editorer har även mer avancerade sökfunktioner där kodmönster kan identifieras och multipla sökträffar markeras över flera kodfiler.

\item \textbf{Markera}. Att markera kod kan göras på många sätt: med piltangenter+Shift, med olika speciella menyalternativ, med mus + dubbelklick eller trippelklick, etc. I vissa editorer finns även möjlighet att ha multipla markörer så att flera rader kan editeras samtidigt.

\item \textbf{Kopiera}. Genom Copy-Paste slipper du du skriva samma sak många gånger. Kortkommandona Ctrl+C för Copy och Ctrl+V för Paste sitter i fingrarna efter ett tag. Man ska dock vara medveten om att det lätt blir fel när man kopierar en stor del som sedan ska ändras lite; många Copy-Paste-buggar kommer av att man inte är tillräckligt noggrann och ofta är det bättre att skriva från grunden i stället för att kopiera så att du hinner tänka efter medan du skriver.

\item \textbf{Klipp ut}. Genom Ctrl+X för Cut och Ctrl+V för Paste, kan du lätt flytta kod. Att skriva kod är en stegvis process där man gör många förändringar under resans gång för att förbättra och vidareutveckla koden. Att flytta på kod för att skapa en bättre struktur är mycket vanligt.

\item \textbf{Formatering}. Med indragningar, radbrytningar och nästlade block i flera nivåer får koden struktur. Många editorer kan hjälpa till med detta och har speciella kortkommandon för att ändra indragningsnivå inåt eller utåt.

\item \textbf{Parentesmatchning}. Olika former av parenteser, \code+ ( { [ ) } ] +,  behöver matchas för att koden ska fungera; annars går kompilatorn ofta helt vilse och konstiga felmeddelanden kan peka på helt fel plats i koden. En bra kodeditor kan hjälpa dig att markera vilka parentespar som hör ihop så att du undviker att spendera för mycket tid med att leta efter en parentes som saknas eller står i vägen.

\end{itemize}

\subsection{Välj editor}\label{appendix:compile:edit}

I tabell \ref{edit:popular-editors} visas en lista med några populära editorer. Det är en stor fördel om din favoriteditor finns på flera plattformar så att du har nytta av dina förvärvade färdigheter när du behöver växla mellan olika operativsystem.

I denna kurs rekommenderas Visual Studio \textbf{\texttt{code}}, eftersom den är öppen, gratis och finns för Linux, Windows och Mac, och har bra stöd för Scala och Java. Men om du redan är van vid någon annan av editorerna i tabell \ref{edit:popular-editors} så fungerar de också bra. 

En integrerad utvecklingsmiljö \Eng{integrated development environment, IDE}, se appendix \ref{appendix:ide}, erbjuder många avancerade funktioner som hjälper dig att koda effektivt när du väl lärt dig handgreppen. VS \texttt{code} har numera flera IDE--funktioner, och gränsen mellan en renodlad editor och en IDE, så som IntelliJ och Eclipse, är inte längre lika tydlig som förr.  %Men även när du lärt dig använda en IDE kommer du fortfarande ha stor nytta av en ''vanlig'' editor. Ofta har man flera terminalfönster igång, tillsammans med flera editorfönster och en IDE.

%Om du jobbar i Linux och hellre vill börja med en enklare editor, kan du prova \texttt{gedit}. När du behöver mer avancerade funktioner kan du gå över till \texttt{code}.

%Det kan vara bra att lära sig de allra mest basala kommandona (starta, spara, ändra text och avsluta) i editorerna \texttt{vim} och \texttt{nano}, eftersom dessa kan köras direkt i terminalen, även vid fjärrinloggning utan fönstersystem, och finns förinstallerade i de flesta Linux-system.


\begin{table}

\renewcommand{\arraystretch}{2.0}\small

    \caption{Några populära editorer. I kursen rekommenderas VS Code.}
    \label{edit:popular-editors}

\begin{longtable}{@{}r | p{0.8\textwidth}}
\textit{Editor} & \textit{Beskrivning} \\ \hline

VS Code & Öppen, fri och gratis. Finns för Linux, Windows, \& Mac. Är förinstallerad på LTH:s Linux-datorer och startas med kommandot \verb+code+. Öppenkällkodsprojektet startades av Microsoft och har en aktiv gemenskap med många utvecklare och många användbara tillägg \Eng{extensions}. Sök efter tillägget \texttt{scalameta.metals} och installera så får du syntaxfärgning och många andra IDE-funktioner för Scala.
\newline \url{https://code.visualstudio.com/} \newline \url{https://scalameta.org/metals/docs/editors/vscode/#installation}\\

Gedit & Öppen, fri och gratis. Lätt att lära men inte så avancerad. Är förinstallerad på LTH:s Linux-datorer och startas med kommandot \verb+gedit+. \newline \url{https://wiki.gnome.org/Apps/Gedit} \\

Nano & Öppen, fri och gratis. En simpel editor för enkla småjobb i terminalen. Är förinstallerad på de flesta Linux-system på planeten Jorden. Startas med kommandot \verb+nano+. \newline \url{https://www.nano-editor.org/}\\

Notepad++ & Öppen, fri och gratis. Utvecklad speciellt för Windows men finns även för Linux. \newline \url{https://notepad-plus-plus.org/} \newline \url{https://snapcraft.io/notepad-plus-plus}\\

Vim & Öppen, fri och gratis. Hög inlärningströskel. Finns för Linux, Windows, \& Mac. Är förinstallerad på LTH:s Linux-datorer och startas med kommandot \verb+vim+. Med Scala Metals (se länk nedan) får du IDE-liknande funktioner. Du avslutar vim genom att trycka Escape och sedan skriva :q och trycka Enter.\newline \url{http://www.vim.org/} \newline \url{https://scalameta.org/metals/docs/editors/vim.html}\\

Emacs & Öppen, fri och gratis. Hög inlärningströskel. Finns för Linux, Windows, \& Mac. Är förinstallerad på LTH:s Linux-datorer och startas med kommandot \verb+emacs+. Med Scala Metals (se länk nedan) får du IDE-liknande funktioner. \newline \url{http://www.gnu.org/software/emacs/} \newline \url{https://scalameta.org/metals/docs/editors/emacs.html}\\

Sublime Text& Sluten källkod. Gratis att prova på, men programmet föreslår då och då att du köper en licens. Finns för Linux, Windows, \& Mac. Med Scala Metals (se länk nedan) får du IDE-funktioner. \newline \url{http://www.sublimetext.com/3} \newline \url{https://scalameta.org/metals/docs/editors/sublime.html} \\



% Textwrangler & Sluten källkod. Gratis. Lätt att lära men inte så avancerad. Finns endast för Mac.
% \newline \url{http://www.barebones.com/products/textwrangler/} \\

\end{longtable}

\end{table}

\section{Vad är en kompilator?}

En \textbf{kompilator} \Eng{compiler} är ett program som läser programtext och översätter den till exekverbar maskinkod, så som visas i figur \ref{fig:appendix:compiler}. Programtexten som kompileras kallas källkod och utgörs av text som följer reglerna för ett programmeringsspråk, till exempel Scala eller Java.

\begin{figure}[H]
\centering
\begin{tikzpicture}[node distance=1.8cm, scale=1.5]
\node (input) [startstop] {\bf\sffamily Källkod};
\node(inptext) [right of=input, text width=2cm, xshift=1.5cm]{För\\människor};
\node (compile) [process, below of=input] {\bf\sffamily Kompilator};
%\node(explain) [right of=compile, text width=5cm, xshift=3.0cm]{Översätter från källkod till maskinkod};
\node (output) [startstop, below of=compile] {\bf\sffamily Maskinkod};
\node(outtext) [right of=output, text width=2cm, xshift=1.5cm]{För\\maskiner};
\draw [arrow] (input) -- (compile);
\draw [arrow] (compile) -- (output);
\end{tikzpicture}
    \caption{En kompilator översätter från källkod till maskinkod.}
    \label{fig:appendix:compiler}
\end{figure}




Vissa kompilatorer genererar kod som kan köras av en processor direkt, medan andra kompilatorer genererar ett mellanformat som tolkas under exekveringen. Det senare är fallet med Java och Scala, vilket möjliggör att programmet kan kompileras en gång för alla plattformar och sedan kan programmet köras på all de processorer till vilka det finns en s.k. virtuell maskin för Java \Eng{Java Virtual Machine, JVM}. Den kod som genereras av en kompilator för JVM kallas \textbf{bytekod}.

Om kompileringen inte lyckas skriver kompilatorn ut ett felmeddelande och ingen maskinkod genereras. Det är inte lätt att bygga en kompilator som ger bra felmeddelanden i alla lägen, men felmeddelandet ger oftast goda ledtrådar till felorsaken efter att man lärt sig tolka det programmeringsspråksspecifika vokabulär som kompilatorn använder.

Även om programmet kompilerar utan felmeddelande och genererar exekverbar maskinkod, är det vanligt att programmet ändå inte fungerar som det är tänkt. Ibland är det mycket svårt att lista ut vad problemet beror på och man kan behöva göra omfattande undersökningar av vad som händer under körningen, genom att t.ex. skriva ut olika variablers värden eller på annat sätt ändra koden och se vad som händer. Denna process kallas felsökning eller avlusning \Eng{debugging}, och är en väsentlig del av all systemutveckling. Läs mer om debugging i Appendix \ref{appendix:debug}.

En uttömmande testning av ett större program, som kör programmets \textit{alla} möjliga exekveringsvägar, är i praktiken omöjlig att genomföra inom rimlig tid, då antalet kombinationsmöjligheter växer mycket snabbt med storleken på programmet.
Därför är kompilatorn ett mycket viktigt hjälpmedel. Med hjälp av den analys och de kontroller som görs av kompilatorn kan många buggar, som annars vore mycket svåra att hitta, undvikas och åtgärdas i kompileringsfasen, redan \textit{innan} man exekverar programmet.


\section{Java JDK}

Scala, Java och flera andra språk använder Java-plattformen som exekveringsmiljö. Om man inte bara vill köra program som andra har utvecklat, utan även utveckla egna program som fungerar i denna miljö, behöver man installera Java Develpment Kit (JDK). Detta utvecklingspaket innehåller flera delar, bland annat:

\begin{itemize}

\item Kompilatorn \texttt{javac} kompilerar Java-program till bytekod som lagras i klassfiler med filnamnsändelsen \texttt{.class}.

\item Exekveringsmiljön Java Runtime Enviroment (JRE) med kommandot \texttt{java} som drar igång den virtuella javamaskinen (Java Virtual Machine) som kan ladda och exekvera bytekod lagrade i klassfiler.

\item Programmet \texttt{jar} som packar ihop många sammanhörande klassfiler till en enda jar-fil som lätt kan distribueras via nätet och sedan köras med \texttt{java}-kommandot på alla maskiner med JRE.

\item Programmet \texttt{javap} som läser klassfiler och skriver ut vad de innehåller i ett format som kan läsas av människor (ett sådant program kallas disassembler).

\item I JDK ingår också en mycket stor mängd färdiga programbibliotek med stöd för nätverkskommunikation, filhantering, grafik, kryptering och en massa annat som behövs när man bygger moderna system.

\end{itemize}

\noindent Du kan läsa mer om Java och dess historik här: \\
\href{https://en.wikipedia.org/wiki/Java_(programming_language)}{https://en.wikipedia.org/wiki/Java\_(programming\_language)}

\subsection{Kontrollera om du har JDK installerat}\label{appendix:compile:check-jdk}

Öppna ett terminalfönster (se appendix \ref{appendix:terminal}) och skriv (observera det avslutande c:et i \texttt{javac}):
\begin{REPLnonum}
javac -version
\end{REPLnonum}
Då ska något som liknar följande skrivas ut, där \texttt{x} och \texttt{y} är siffror:\\
\texttt{javac \JDKVersion.x.y}\\
Om utskriften säger att \texttt{javac} saknas, installera JDK enl. nedan.

Vi använder alltså JDK \JDKVersion~i kursen. Det går också bra att använda de äldre versionerna JDK 8 och JDK 11, men JDK 9 eller 10 fungerar inte med alla verktyg vi använder och senare versioner än \JDKVersion~ kan också ge problem. Läs mer under ''Verktyg'' på kurshemsidan.

%Du kanske redan har enbart Java Runtime Environment (JRE) installerad, men inte JDK. Då saknar du Javakompilatorn \texttt{javac} m.m. och behöver installera JDK, se nedan. Du kan kolla om du har JRE genom att skriva \texttt{java -version} (alltså utan \texttt{c} efter \texttt{java}). Eller så har du redan JDK installerad men inte rätt katalog i din PATH. 





\subsection{Installera JDK}\label{appendix:compile:install-jdk}

Det finns flera JDK-distributioner att välja mellan, varav OpenJDK och Oracle JDK är två exempel. Vi använder OpenJDK i kursen, som kan installeras via \\ \url{https://adoptium.net/temurin/releases/?version=21}. 

Om du installerar alla Scala-verktyg med hjälp av Coursier enligt instruktioner på kurshemsidan under ''Verktyg'', \url{https://lunduniversity.github.io/pgk/#verktyg} så kommer JDK att installeras automatiskt (om du inte redan har JDK). % För att installera JDK på din egen dator behöver du gå igenom flera steg, varav vissa behöver anpassas efter det operativsystem du kör, enligt nedan.

%
%
%
% Din användaridentitet behöver ha administratörsrättigheter för att du ska kunna genomföra installationen.
%
%
%
% \subsubsection{Linux}
% För Ubuntu: läs igenom och följ sedan dessa instruktioner noga: \\ \href{http://www.webupd8.org/2012/09/install-oracle-java-8-in-ubuntu-via-ppa.html}{www.webupd8.org/2012/09/install-oracle-java-8-in-ubuntu-via-ppa.html}
%
% För andra Linux-distributioner, kör detta i terminalen (funkar även i Ubuntu, men du får med detta kommando inte Oracles aningen snabbare JVM): \\ \texttt{sudo apt-get install openjdk-8-jdk}
%
% \subsubsection{Windows/macOS}
%
% \begin{enumerate}
% \item Installera senaste JDK från Oracle. Om du inte har installerat JDK förr på din dator så be gärna någon kurskamrat med erfarenhet av detta att assistera dig medan du följer stegen nedan.
%
% \begin{enumerate}
% \item Surfa till Oracles hemsida för Java SE här: \\ \url{http://www.oracle.com/technetwork/java/javase/downloads/}
%
% \item Klicka på rubriken ''Java SE 8u101 / 8u102'' och på nästa sida klicka på knappen ''Accept License Agreement'' i listan under rubriken ''Java SE Development Kit 8u101''. (Siffrorna 101 eller 102 kan vara annorlunda om senare versioner tillkommit.)
%
% \item Välj rätt version av operativsystem (Windows x64 eller Mac OS X). Det är viktigt att du väljer x64, d.v.s 64-bitarsvarianten som gäller för alla moderna datorer.
%
% \item Klicka på länken och en stor fil kommer laddas ner till din dator.
%
% \item Installera när filen laddats färdigt.
%
% \end{enumerate}
%
% \item Uppdatera PATH, så att du får tillgång till alla kommando i terminalen:
% \begin{itemize}
% \item För Windows görs detta enklast genom att ladda ner och sedan köra denna fil genom att dubbelklicka på den: \\ \mbox{\href{https://github.com/lunduniversity/introprog/raw/master/tools/windows-jdk-set-path.bat}{github.com/lunduniversity/introprog/raw/master/tools/windows-jdk-set-path.bat}}
% \item För macOS, läs här: \\ \href{https://docs.oracle.com/javase/8/docs/technotes/guides/install/mac_jdk.html}{docs.oracle.com/javase/8/docs/technotes/guides/install/mac\_jdk.html}
% \\ Ge bästa rådet att sätta path på mac; HOMEBREW!!!
%
% \item Om något krånglar, be om hjälp. Om du behöver mer detaljer om PATH-uppdatering för java, läs här:  \href{https://java.com/sv/download/help/path.xml}{java.com/sv/download/help/path.xml} \\
% Om du kör engelska menyer byt \texttt{sv} mot \texttt{en} i adressen ovan.  Du kan ta reda på vilken katalog som ska läggas in sist i din PATH genom att bläddra bland dina systemfiler och undersöka var JDK har installerats; i Windows antagligen något liknande detta (kolla exakt vilket versionsnummer du har): \code|C:\Program Files\Java\jdk1.8.0_101\bin|
% \end{itemize}
%
% \item Starta om datorn. Det är först efter att en ny användarinloggning initierats, som PATH-tilldelningen får effekt.
%
% \item Kontrollera att \texttt{javac} fungerar enligt avsnitt \ref{appendix:compile:check-jdk}.
% \end{enumerate}


\section{Scala}

Scala använder Java Virtual Machine (JVM) som exekveringsmiljö, men går även att köra i browsern med hjälp av ScalaJS-kompilatorn som kompilerar från Scala till JavaScript. I denna kurs använder vi i Scala på JVM.
I en Scala-installation ingår bl.a. kompilatorn \texttt{scalac} och även ett interaktivt kommandoskal kallat Scala REPL (se nedan \ref{appendix:compile:REPL}) där du kan testa din Scala-kod rad för rad och se vad som händer direkt.

%De flesta av kursens övningar görs i Scala REPL (förk. \textit{read-evaluate-print-loop}), medan laborationerna kräver kompilering av lite större program.

Den officiella hemsidan för Scala finns här: \url{http://www.scala-lang.org/}

Du hittar mer om Scalas historik och annan bakgrundsinformation här:\\\mbox{%
 \href{https://en.wikipedia.org/wiki/Scala_(programming_language)}{en.wikipedia.org/wiki/Scala\_(programming\_language)}
}

\subsection{Installera Scala}

Scala finns förinstallerat på LTH:s datorer. På kurshemsidan under ''Verktyg'' finns detaljerade instruktioner om hur du installerar Scala på din egen dator:  \\ \url{https://lunduniversity.github.io/pgk/#verktyg}

% \begin{enumerate}
% \item Kontrollera att du har JDK installerad enligt avsnitt \ref{appendix:compile:check-jdk} och installera vid behov enligt avsnitt \ref{appendix:compile:install-jdk}.
% \item Surfa till denna hemsida för nedladdning av Scala 2.11.8: \\ \url{http://scala-lang.org/download/2.11.8.html}
% \item Klicka på ''Download'' av den variant som är relevant för ditt operativsystem och spara filen:
%
% \begin{enumerate}
% \item \textbf{Linux Ubuntu}: Filen heter \texttt{scala-2.11.8.deb} och installeras genom att dubbelklicka på filen eller via terminalkommandot:\\ \code{sudo apt install ~/Downloads/scala-2.11.8.deb} \\ Anpassa sökvägen ovan efter var du sparade filen.
% \item \textbf{Windows}: Filen heter \texttt{scala-2.11.8.msi} och installationen startas med ett dubbelklick. Följ instruktionerna. Installationsprogrammet uppdaterar även din PATH åt dig och kommandot \texttt{scala} bör fungera efter omstart.
% \item \textbf{Mac}: Filen heter \texttt{scala-2.11.8.tgz} och kan packas upp på lämpligt ställe med terminalkommandot \texttt{tar -xvzf scala-2.11.8.tgz} och sedan är det underkatalogen \texttt{bin} som ska inkluderas i din PATH. \TODO klura ut säkraste rådet för PATH-uppdatering på mac -- enklast är nog att visa hur man installerar via homebrew
% \end{enumerate}
% \end{enumerate}
% Kontrollera, efter ev. omstart, att terminalkommandot \texttt{scala} nu kan användas för att starta Scala REPL på din dator:
% \begin{REPLnonum}
% > scala
% Welcome to Scala 2.11.8 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_101).
% Type in expressions for evaluation. Or try :help.
%
% scala> val msg = "hej"
% msg: String = hej
%
% scala> println(msg)
% hej
%
% scala>
% \end{REPLnonum}


\subsection{Scala Read-Evaluate-Print-Loop (REPL)}\label{appendix:compile:REPL}

För många språk, t.ex. Scala och Python, finns det ett interaktivt program ämnat för terminalen som gör det möjligt att exekvera enstaka programrader och direkt se effekten. Ett sådant program kallas \textit{Read-Evaluate-Print-Loop} (REPL), eftersom det läser  och tolkar en rad i taget. Resultatet av evalueringen av din kod skrivs ut i terminalen och därefter är kommandoskalet redo för nästa kodrad.

Kursens övningar bygger till stor del på att du använder Scala REPL för att undersöka principer och begrepp som ingår i kursen genom dina egna kodexperiment. Även när du på labbarna utvecklar större program med en editor och en IDE, är det bra att ha Scala REPL till hands. Då kan du klistra in delar av programmet du håller på att utveckla i Scala REPL och stegvis utveckla delprogram, som till slut fungerar så som du vill.

I Scala REPL får du se typinformation för variabler och metoder, vilket är till stor hjälp när man försöker lista ut vad en kodrad innebär. Genom att öva upp din förmåga att dra nytta av Scala REPL, kommer din produktivitet öka.

Du startar Scala REPL med kommandot \texttt{scala} och skriver Scala-kod efter prompten \texttt{scala>} och kompilering+exekvering sker när du trycker Enter.
\begin{REPLnonum}
> scala
Welcome to Scala 3.1.2 (17.0.2, Java OpenJDK 64-Bit Server VM).
Type in expressions for evaluation. Or try :help.
                                                                                                                               
scala> 41 + 1
val res0: Int = 42
\end{REPLnonum}

Varje evaluerat värde sparas i en ny variabel, här \code{res0}.

Om du skriver en ofullständig rad fortsätter editeringen på nästa rad. Du kan navigera mellan raderna med pil-upp- och pil-ner-tangenterna. När du avslutar med en rad som gör din kod fullständig så kompileras och exekveras alla raderna. Du kan avbryta flerradsediteringen i förtid genom skriva ett semikolon \texttt{;} och sen trycka Enter. Vill du fortsätta editeringen med en ny rad och förhindra för tidig evaluering så tryck Esc+Enter. Escape-tangenten finns överst till vänster på tangentbordet. Se exempel nedan:

\begin{REPLnonum}
scala> def fleraRader = 42  // Esc+Enter ger ny rad
     |   + "ny rad".length  // fortsättningsrad, avsluta med Enter
\end{REPLnonum}

Beroende på vilket operativsystem du kör så kan även andra tangentkombinationer fungera för att starta ny rad i REPL; prova t.ex. Linux: Left Alt+Enter, Windows: Left Alt + Shift + Enter, VS Code Terminal i Windows Left Alt + Enter, VS Code Terminal i MacOS: Option + Enter.

Många av de kortkommandon som fungerar i terminalens kommandoskal, fungerar också i Scala REPL. Gå gärna igenom listan i tabell \ref{fig:terminal:shortcuts} på sidan \pageref{fig:terminal:shortcuts}, och testa vad som händer i Scala REPL. Om du tränar upp din fingerfärdighet med dessa kortkommandon, går ditt arbete i Scala REPL väsentligt snabbare.

Med kommandot \texttt{:help} får du se en lista med specialkommandon för Scala REPL:

\begin{REPLsmall}
The REPL has several commands available:

:help                    print this summary
:load <path>             interpret lines in a file
:quit                    exit the interpreter
:type <expression>       evaluate the type of the given expression
:doc <expression>        print the documentation for the given expression
:imports                 show import history
:reset [options]         reset the repl to its initial state, forgetting all session entries
:settings <options>      update compiler options, if possible


\end{REPLsmall}

Du kan också starta Scala REPL med hjälpa av kommandot \code{scala repl . } ~med ett blanktecken och en punkt på slutet. Punkten gör att alla \code{.scala}-filer som finns i aktuell katalog kompileras av Scala CLI och görs tillgänglig för användning i REPL.  

\subsection{Kompilera och kör med Scala Command Line Interface}\label{appendix:compile:scala-cli}

Det finns sedan 2022 ett nytt smidigt kommandoradsgränssnitt \Eng{command line interface} för att kompilera, exekvera och paketera Scala-program som kallas \emph{Scala CLI}. Om du installerar Scala-verktygen enligt instruktioner på kurshemsidan under ''Verktyg'', \url{https://lunduniversity.github.io/pgk/#verktyg} så medföljer Scala CLI. 

Här finns några användbara kommandon:
\begin{itemize}
\item Första gången du kör en nyinstallerad Scala CLI-installation så kör detta kommando så att du får tillgång till smidiga kompletteringar med TAB-tangenten:\\
\texttt{scala install completions}

\item Med hjälp av detta kommando kan du förbereda VS Code för samverkan med Scala CLI (notera blanktecken och avslutande punkt):\\ 
\texttt{scala setup-ide .}\\
Kör ovan kommando innan du startar VS Code första gången med \texttt{code .} i aktuell katalog, eller avsluta VS Code och kör ovan kommando och starta VS Code igen med \texttt{code .}  i aktuell katalog.


\item Scala CLI kan köra igång REPL i aktuell katalog med dina Scala- och Java-program automatiskt kompilerade och tillgängliggjorda i REPL med hjälp av nedan kommando. Med optionen \code{-S} anger du vilken version av Scala du vill köra:\\
\texttt{scala repl . -S \ScalaVersion}

\item I stället för att ange Scala-version med optionen \code{-S} på kommandoraden kan du inuti ditt program, på första raden, skriva denna ''magiska'' kommentar:\\ 
\texttt{//> using scala \ScalaVersion} \\
Då kommer Scala CLI att automatiskt välja (och vid behov ladda ned) önskad version av Scala-kompilatorn (notera \code{>} efter \texttt{//}):

\item Kompilera alla Scala- och Java-program i aktuell katalog och se eventuella felmeddelanden. Med hjälp av \code{--watch} (kan förkortas till \code{-w}) så kompileras alla filer automatiskt om så fort ändringar sparas i VS Code (kortkommando Ctrl+S):\\
\code{scala compile . --watch}

\item Kör Scala- och Java-program i aktuell katalog med start av den topp-nivå-\code{def} som är märkt \code{@main} (om det finns flera får du en frågan om vilken \code{@main def} du vill köra).:\\
\code{scala run .}

\item Skapa en exekverbar fil:\\
\texttt{scala package .}

\item Skapa en kopia av ditt projekt med katalogstruktur och filer anpassade för byggverktyget \code{sbt} (se Appendix \ref{appendix:build}):\\
\verb|scala export . --sbt --output ../nameofnewprojdir|\\
Ändra katalognamnet \code{nameofnewprojdir} till valfritt nytt namn på en katalog som inte existerar. Notera de dubbla punkterna som gör att nya katalogen hamnar på samma nivå som ditt nuvarande projekt, och \emph{inte} i din aktuella katalog (för att undvika att dubbletter av dina scala-filer ger kompileringsfel).

\item Om du skriver \texttt{scala help} så får du se vad du mer kan göra.
\end{itemize}


\noindent
Läs mer om Scala CLI i Appendix \ref{appendix:build:scala-cli} och här: \\ \url{https://scala-cli.virtuslab.org/}


% \begin{table}
% \renewcommand{\arraystretch}{1.25}\centering
%     \caption{Några vanliga kommandon i Scala REPL.}
%     \label{fig:repl:shortcuts}
% \begin{tabular}{r | c | l}
% \textit{Kommando} & \textit{Förk.} & \textit{Beskrivning} \\ \hline
%  \texttt{:help}     & \texttt{:he} & visa lista med kommando och förklaringar\\
%  \texttt{:load} \textit{path}    & \texttt{:load} \textit{path} & klistra in en hel fil, t.ex. \code|:load util/mio.scala|\\
%  \texttt{:quit} & \texttt{:q}  & avsluta Scala REPL \\
%  \texttt{:require} \textit{path} & \texttt{:req} \textit{path} & jar-fil till classpath, t.ex. \texttt{:req lib/cslib.jar}\\

%  \texttt{:type} & \texttt{:t}  & visa typ med -v för ''verbose'', t.ex. \code|:t -v 42.0| \\

%  \texttt{:warnings} & \texttt{:w}  & visa beskrivning av ev. varningar \\

% \end{tabular}

% \end{table}
